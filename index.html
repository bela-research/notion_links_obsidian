<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Obsidian Megnyitása...</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding-top: 50px; color: #333; }
        .message { font-size: 1.2rem; }
    </style>
</head>
<body>
    <div class="message">
        Megnyitás Obsidianban...<br>
        <small>(Az ablak 5 másodperc múlva bezárul)</small>
    </div>

    <script>
        // 1. A teljes URL-t nézzük, nem bontjuk paraméterekre
        const queryString = window.location.search;
        
        // 2. Megkeressük hol kezdődik a "link=" rész
        const searchPhrase = "link=";
        const startIndex = queryString.indexOf(searchPhrase);

        if (startIndex !== -1) {
            // 3. Levágunk mindent a "link=" után (így az & jelek is megmaradnak!)
            // A +5 a "link=" hossza
            let targetLink = queryString.substring(startIndex + searchPhrase.length);

            // Ha a link véletlenül kódolva érkezne (pl. %3A), visszakódoljuk, de csak ha nem obszidián link
            if (!targetLink.startsWith("obsidian://")) {
                 targetLink = decodeURIComponent(targetLink);
            }

            // Biztonsági ellenőrzés
            if (targetLink.includes("obsidian://")) {
                // 4. Megnyitás
                window.location.href = targetLink;

                // 5. Bezárás 5 másodperc múlva
                setTimeout(() => {
                    window.close();
                }, 5000);
            } else {
                 document.body.innerHTML = "<h3>Hiba: A link nem tűnik Obsidian linknek.</h3>";
            }
        } else {
            document.body.innerHTML = "<h3>Hiba: Nincs megadva link.</h3>";
        }
    </script>
</body>
</html>
